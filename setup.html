<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4a148c 0%, #1a237e 50%, #006064 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #1a1a1a;
        }

        /* Add subtle animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(138, 92, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(29, 78, 216, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(0, 150, 136, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 980px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 48px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #8B5CF6 0%, #3B82F6 50%, #14B8A6 100%);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 40px;
            letter-spacing: -0.5px;
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f5;
            border-radius: 100px;
            margin-bottom: 40px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6 0%, #3B82F6 100%);
            width: 20%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 100px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Form sections */
        .form-section {
            margin-bottom: 24px;
            border: none;
            border-radius: 16px;
            overflow: hidden;
            background: #f8f9fb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .form-section:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .section-header {
            background: linear-gradient(135deg, #fafbfc 0%, #f3f4f6 100%);
            padding: 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }

        .section-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-toggle {
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-header.open .section-toggle {
            transform: rotate(180deg);
            background: #8B5CF6;
            color: white;
        }

        .section-content {
            padding: 32px;
            display: none;
            background: white;
        }

        .section-content.open {
            display: block;
        }

        .section-description {
            color: #6b7280;
            font-size: 0.95rem;
            margin-bottom: 28px;
            font-weight: 400;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-row-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 500;
            color: #374151;
            font-size: 0.95rem;
            letter-spacing: -0.01em;
        }

        /* Enhanced info icon with better tooltips */
        .info-icon {
            margin-left: 8px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            border-radius: 50%;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            cursor: help;
            position: relative;
            transition: all 0.2s ease;
            vertical-align: middle;
            flex-shrink: 0;
        }

        .info-icon:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
        }

        .tooltip {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            background: #1f2937;
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 13px;
            white-space: normal;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            max-width: 320px;
            width: max-content;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-weight: 400;
            letter-spacing: 0;
            line-height: 1.5;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #1f2937;
        }

        .info-icon:hover .tooltip {
            opacity: 1;
            transform: translateX(-50%) scale(1) translateY(-6px);
        }

        .tooltip strong {
            color: #8B5CF6;
            display: block;
            margin-bottom: 2px;
        }

        .tooltip br {
            margin-bottom: 4px;
        }

        input, textarea, select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        input:hover, textarea:hover, select:hover {
            border-color: #d1d5db;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #8B5CF6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .conditional-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(4px);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            color: #6b7280;
            z-index: 5;
            font-size: 1.1rem;
            max-width: 100%;
            max-height: 100%;
        }

        /* Time slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 12px;
            max-height: 320px;
            overflow-y: auto;
            padding: 16px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .time-slots::-webkit-scrollbar {
            width: 8px;
        }

        .time-slots::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 4px;
        }

        .time-slots::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        .time-slots::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .time-slot {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .time-slot:hover {
            border-color: #8B5CF6;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }

        .time-slot.selected {
            border-color: #8B5CF6;
            background: linear-gradient(135deg, #f3f0ff 0%, #ede9fe 100%);
            color: #7C3AED;
        }

        .time-slot input {
            width: auto !important;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #8B5CF6;
        }

        /* Activity grid */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .activity-option {
            display: flex;
            align-items: center;
            padding: 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .activity-option:hover {
            border-color: #8B5CF6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }

        .activity-option.selected {
            border-color: #8B5CF6;
            background: linear-gradient(135deg, #f3f0ff 0%, #ede9fe 100%);
            color: #7C3AED;
        }

        .activity-option input {
            width: auto !important;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #8B5CF6;
        }

        /* Color options */
        .color-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .color-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            font-weight: 500;
        }

        .color-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .color-option.selected {
            border-color: #1f2937;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            margin-right: 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-option input {
            width: auto !important;
            margin: 0;
            position: absolute;
            opacity: 0;
        }

        /* Alert options */
        .alert-option {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            background: white;
        }

        .alert-option:hover {
            border-color: #8B5CF6;
            background: #fafafe;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }

        .alert-option.selected {
            border-color: #8B5CF6;
            background: linear-gradient(135deg, #f3f0ff 0%, #ede9fe 100%);
        }

        .alert-option input {
            margin: 4px 16px 0 0;
            width: auto !important;
            accent-color: #8B5CF6;
        }

        .alert-option strong {
            font-weight: 600;
            color: #1f2937;
        }

        .alert-option p {
            margin: 6px 0 0 0;
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }

        /* Generate button */
        .generate-btn {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 40px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(139, 92, 246, 0.4);
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
        }

        /* Embed code section */
        .embed-code {
            background: #0f172a;
            color: #e2e8f0;
            padding: 28px;
            border-radius: 14px;
            margin-top: 28px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            position: relative;
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.3);
            font-size: 14px;
            line-height: 1.6;
        }

        .copy-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        /* Help text */
        .help-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 10px;
        }

        /* SMS Fields */
        #smsFields {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        #smsFields .form-group {
            margin-bottom: 16px;
        }

        #smsFields .form-group:last-child {
            margin-bottom: 0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 32px 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .form-row,
            .form-row-three {
                grid-template-columns: 1fr;
            }

            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .activity-grid {
                grid-template-columns: 1fr;
            }

            .color-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .tooltip {
                max-width: 280px;
                font-size: 12px;
                padding: 10px 14px;
                bottom: 35px;
            }
            
            .info-icon {
                width: 18px;
                height: 18px;
                font-size: 11px;
            }
        }

        /* Success section styling */
        #embedSection h3 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 48px 0 24px 0;
        }

        #embedSection a {
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            transition: all 0.2s ease;
        }

        #embedSection a:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚤 Enhanced Chatbot Setup</h1>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <form id="chatbotForm">
            <!-- Basic Information -->
            <div class="form-section">
                <div class="section-header open" onclick="toggleSection(this)">
                    <h3>📋 Basic Information</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content open">
                    <div class="section-description">Core details about your business and tour offerings</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessName">Business Name *</label>
                            <input type="text" id="businessName" required placeholder="Key West Boat Tours">
                        </div>
                        <div class="form-group">
                            <label for="businessType">Primary Activity *</label>
                            <select id="businessType">
                                <option>Boat Tours</option>
                                <option>Jet Ski Rentals</option>
                                <option>Fishing Charters</option>
                                <option>Kayak Tours</option>
                                <option>Hiking Tours</option>
                                <option>City Tours</option>
                                <option>Food Tours</option>
                                <option>Wine Tasting</option>
                                <option>Adventure Sports</option>
                                <option>Cultural Experiences</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="location">Location / Meeting Point *</label>
                        <input type="text" id="location" placeholder="Marina Bay, Dock 5" required>
                    </div>
                    <div class="form-group">
    <label for="weatherLocation">
        🌤️ City/Region for Weather *
        <span class="info-icon">i
            <div class="tooltip">City and state/country for weather updates. Examples: "Key West, FL", "San Diego, CA", "Sydney, Australia"</div>
        </span>
    </label>
    <input type="text" id="weatherLocation" placeholder="Key West, FL" required>
    <p class="help-text">Used for real-time weather responses to customers</p>
</div>
                </div>
            </div>

            

            <!-- Business Details -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>🏢 Business Details</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Additional business information for better customer service</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="websiteUrl">Website URL</label>
                            <input type="url" id="websiteUrl" placeholder="https://www.yourbusiness.com">
                        </div>
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" placeholder="+1 (555) 123-4567">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessHours">Business Hours</label>
                            <input type="text" id="businessHours" placeholder="8 AM - 6 PM daily">
                        </div>
                        <div class="form-group">
                            <label for="peakSeason">Peak Season</label>
                            <input type="text" id="peakSeason" placeholder="December - April">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="maxGroupSize">Maximum Group Size</label>
                            <input type="number" id="maxGroupSize" placeholder="12" min="1">
                        </div>
                        <div class="form-group">
                            <label for="companyTagline">Company Tagline</label>
                            <input type="text" id="companyTagline" placeholder="Creating unforgettable adventures">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Customization -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>🎯 Activity Customization</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Detailed information about your activities and requirements</div>
                    
                    <div class="form-group">
                        <label>Activity Types (select all that apply)</label>
                        <div class="activity-grid">
                            <label class="activity-option">
                                <input type="checkbox" value="Boat Tours" onchange="updateActivityOption(this)">
                                <span>🚤 Boat Tours</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Fishing" onchange="updateActivityOption(this)">
                                <span>🎣 Fishing</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Snorkeling" onchange="updateActivityOption(this)">
                                <span>🤿 Snorkeling</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Kayaking" onchange="updateActivityOption(this)">
                                <span>🛶 Kayaking</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Hiking" onchange="updateActivityOption(this)">
                                <span>🥾 Hiking</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="City Tours" onchange="updateActivityOption(this)">
                                <span>🏛️ City Tours</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Food Tours" onchange="updateActivityOption(this)">
                                <span>🍽️ Food Tours</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Wine Tasting" onchange="updateActivityOption(this)">
                                <span>🍷 Wine Tasting</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Adventure Sports" onchange="updateActivityOption(this)">
                                <span>🏄 Adventure Sports</span>
                            </label>
                            <label class="activity-option">
                                <input type="checkbox" value="Cultural Experiences" onchange="updateActivityOption(this)">
                                <span>🎭 Cultural</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-row-three">
                        <div class="form-group">
                            <label for="difficultyLevel">
                                Difficulty Level
                                <span class="info-icon">i
                                    <div class="tooltip">How challenging your activity is for participants</div>
                                </span>
                            </label>
                            <select id="difficultyLevel">
                                <option>Beginner</option>
                                <option>Intermediate</option>
                                <option>Advanced</option>
                                <option>All Levels</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="minAge">Minimum Age</label>
                            <input type="number" id="minAge" placeholder="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="maxAge">Maximum Age (0 = no limit)</label>
                            <input type="number" id="maxAge" placeholder="0" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="durationOptions">
                                Duration Options
                                <span class="info-icon">i
                                    <div class="tooltip">Category of how long your tours typically last</div>
                                </span>
                            </label>
                            <select id="durationOptions">
                                <option>Half-day (2-4 hours)</option>
                                <option>Full-day (6-8 hours)</option>
                                <option>Multi-day</option>
                                <option>Custom duration</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seasonalAvailability">
                                Seasonal Availability
                                <span class="info-icon">i
                                    <div class="tooltip">When during the year your tours operate</div>
                                </span>
                            </label>
                            <select id="seasonalAvailability">
                                <option>Year-round</option>
                                <option>Seasonal (specify dates)</option>
                                <option>Weather dependent</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Features -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>⚡ Advanced Features</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Enhanced functionality and integrations</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bookingLink">
                                Booking System Link
                                <span class="info-icon">i
                                    <div class="tooltip">If you provide a booking system URL, the bot will defer all pricing and scheduling questions to your booking system instead of trying to answer them. This ensures customers get current prices and availability.</div>
                                </span>
                            </label>
                            <input type="url" id="bookingLink" placeholder="https://your-booking-system.com" oninput="toggleConditionalSections()" onchange="toggleConditionalSections()">
                        </div>
                        <div class="form-group">
                            <label for="socialMedia">
                                Social Media Links
                                <span class="info-icon">i
                                    <div class="tooltip">Your social media handles or URLs. The bot can mention these when customers ask about following you or seeing more photos.<br><strong>Example:</strong> "Instagram: @yourbusiness, Facebook: /yourbusiness"</div>
                                </span>
                            </label>
                            <input type="text" id="socialMedia" placeholder="Instagram: @yourbusiness, Facebook: /yourbusiness">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="certifications">
                            Safety Certifications & Licenses
                            <span class="info-icon">i
                                <div class="tooltip">Your safety credentials, licenses, and insurance information. This builds customer confidence.<br><strong>Examples:</strong> "Coast Guard licensed", "First Aid certified", "Fully insured with XYZ Insurance"</div>
                            </span>
                        </label>
                        <textarea id="certifications" placeholder="Coast Guard licensed, First Aid certified, Insured with..."></textarea>
                    </div>
                    <div class="form-group">
    <label for="weatherEnabled">
        🌤️ Real-Time Weather Responses
        <span class="info-icon">i
            <div class="tooltip">Enable automatic weather responses when customers ask about conditions. Great for outdoor activities!</div>
        </span>
    </label>
    <select id="weatherEnabled">
        <option value="true">Enable weather responses</option>
        <option value="false">Disable weather responses</option>
    </select>
</div>

<div class="form-group">
    <label for="weatherStyle">
        Weather Response Style
        <span class="info-icon">i
            <div class="tooltip">How detailed should weather responses be?</div>
        </span>
    </label>
    <select id="weatherStyle">
        <option value="simple">Simple ("75°F and sunny!")</option>
        <option value="detailed">Detailed (temp, conditions, wind, humidity)</option>
        <option value="tour-focused">Tour-focused ("Perfect weather for kayaking!")</option>
    </select>
</div>
                </div>
            </div>

            <!-- Tour Schedule (conditional) -->
            <div class="form-section conditional-section" id="scheduleSection">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>⏰ Tour Schedule</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">When your tours run and how long they last</div>
                    
                    <div class="form-group">
                        <label>Standard Tour Times (select all that apply)</label>
                        <div class="time-slots" id="timeSlots">
                            <!-- Time slots will be generated by JavaScript -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="duration">Typical Tour Duration</label>
                        <input type="text" id="duration" placeholder="2.5 hours">
                    </div>
                </div>
            </div>

            <!-- Pricing (conditional) -->
            <div class="form-section conditional-section" id="pricingSection">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>💰 Pricing</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Your pricing structure and special offers</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adultPrice">Adult Price</label>
                            <input type="text" id="adultPrice" placeholder="$95 USD">
                        </div>
                        <div class="form-group">
                            <label for="childPrice">Child Price</label>
                            <input type="text" id="childPrice" placeholder="$65 USD (ages 4-12)">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="groupDiscount">Group Discount</label>
                            <input type="text" id="groupDiscount" placeholder="15% off for 6+ people">
                        </div>
                        <div class="form-group">
                            <label for="specialOffers">Current Special Offers</label>
                            <input type="text" id="specialOffers" placeholder="Book 2 tours, get 10% off">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Policies -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>📋 Policies</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Important policies and what customers should know</div>
                    
                    <div class="form-group">
                        <label for="whatToBring">What to Bring</label>
                        <textarea id="whatToBring" placeholder="Sunscreen, sunglasses, camera">Sunscreen, sunglasses, camera, light jacket for evening tours</textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cancellationPolicy">Cancellation Policy</label>
                            <textarea id="cancellationPolicy" placeholder="Full refund if cancelled 24 hours before tour">Full refund if cancelled 24 hours before tour</textarea>
                        </div>
                        <div class="form-group">
                            <label for="weatherPolicy">Weather Policy</label>
                            <input type="text" id="weatherPolicy" placeholder="Tours run in light rain, full refund for storms">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chatbot Personality -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>🤖 Chatbot Personality</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Customize how your chatbot communicates with customers</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="chatbotTone">
                                Communication Tone
                                <span class="info-icon">i
                                    <div class="tooltip"><strong>Friendly:</strong> Warm & welcoming (default)<br><strong>Professional:</strong> Courteous & formal business language<br><strong>Casual:</strong> Relaxed & informal, like talking to a friend<br><strong>Enthusiastic:</strong> Energetic with emojis and excitement</div>
                                </span>
                            </label>
                            <select id="chatbotTone">
                                <option>Friendly</option>
                                <option>Professional</option>
                                <option>Casual</option>
                                <option>Enthusiastic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="languageStyle">
                                Language Style
                                <span class="info-icon">i
                                    <div class="tooltip"><strong>Conversational:</strong> Natural, everyday language<br><strong>Formal:</strong> Business-appropriate, proper grammar<br><strong>Local/Regional:</strong> Uses local expressions and terminology</div>
                                </span>
                            </label>
                            <select id="languageStyle">
                                <option>Conversational</option>
                                <option>Formal</option>
                                <option>Local/Regional</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="expertiseLevel">
                                Information Level
                                <span class="info-icon">i
                                    <div class="tooltip"><strong>Basic:</strong> Simple, easy-to-understand answers<br><strong>Detailed expert:</strong> In-depth technical information and specifics<br><strong>Educational:</strong> Focus on teaching and learning opportunities</div>
                                </span>
                            </label>
                            <select id="expertiseLevel">
                                <option>Basic information</option>
                                <option>Detailed expert knowledge</option>
                                <option>Educational focus</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="responseLength">
                                Response Length
                                <span class="info-icon">i
                                    <div class="tooltip">How long should the bot's typical responses be?<br><strong>Brief:</strong> 1-2 sentences, quick answers<br><strong>Moderate:</strong> 2-3 sentences, balanced detail<br><strong>Detailed:</strong> 3-4 sentences, comprehensive answers</div>
                                </span>
                            </label>
                            <select id="responseLength">
                                <option>Brief (1-2 sentences)</option>
                                <option>Moderate (2-3 sentences)</option>
                                <option>Detailed (3-4 sentences)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customGreeting">Custom Welcome Message</label>
                        <textarea id="customGreeting" placeholder="Hi! Welcome to [Business Name]. I'm here to help you plan your perfect adventure!"></textarea>
                    </div>
                </div>
            </div>

            <!-- Knowledge Boundaries -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>🧠 Knowledge Boundaries</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Help your chatbot know what it should and shouldn't answer</div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="realTimeInfo">
                                Real-Time Information
                                <span class="info-icon">i
                                    <div class="tooltip">List topics that change daily that the bot shouldn't guess about.<br><strong>Examples:</strong> Current weather, today's conditions, live availability, water temperature, tide times</div>
                                </span>
                            </label>
                            <textarea id="realTimeInfo" placeholder="Current weather, today's conditions, live availability, water temperature, tide times"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="dontAnswerTopics">
                                Topics to Avoid
                                <span class="info-icon">i
                                    <div class="tooltip">Topics the bot should never attempt to answer.<br><strong>Examples:</strong> Medical advice, legal matters, specific future dates, personal recommendations outside your expertise</div>
                                </span>
                            </label>
                            <textarea id="dontAnswerTopics" placeholder="Medical advice, legal matters, specific future dates, personal recommendations"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="additionalKnowledge">
                            Additional Knowledge
                            <span class="info-icon">i
                                <div class="tooltip">Specific facts the bot should know about your business.<br><strong>Examples:</strong> "Free parking at Marina Lot B", "Best photo spot is at sunset point", "Dolphins most active in morning"</div>
                            </span>
                        </label>
                        <textarea id="additionalKnowledge" placeholder="Free parking at Marina Lot B, Best photo spot is at sunset point, Dolphins most active in morning"></textarea>
                    </div>
                </div>
            </div>

            <!-- Contact Preferences -->
            <!-- Contact Preferences - COMPLETE SECTION -->
<div class="form-section">
    <div class="section-header" onclick="toggleSection(this)">
        <h3>📞 Contact Preferences</h3>
        <span class="section-toggle">▼</span>
    </div>
    <div class="section-content">
        <div class="section-description">How and when customers can reach your team</div>
        
        <div class="form-group">
            <label>
                When customers request to speak with a human, how would you like to be alerted?
                <span class="info-icon">i
                    <div class="tooltip"><strong>Let AI handle everything:</strong> No alerts, bot redirects to automated help<br><strong>Email alerts:</strong> Get notified by email, contact customers externally<br><strong>Two-way chat dashboard:</strong> Respond directly in the chat through a web dashboard</div>
                </span>
            </label>
            <div style="margin-top: 15px;">
                <!-- Option 1: AI Only -->
                <label class="alert-option" onclick="updateAlertOption(this)">
                    <input type="radio" name="alertPreference" value="none">
                    <div>
                        <strong>🤖 Let AI handle everything</strong>
                        <p style="margin: 5px 0 0 0; font-size: 14px; color: #6b7280;">The chatbot will redirect customers back to automated help. No alerts sent to you.</p>
                    </div>
                </label>
                
                <!-- Option 2: Email Alerts -->
                <label class="alert-option selected" onclick="updateAlertOption(this)">
                    <input type="radio" name="alertPreference" value="email" checked>
                    <div>
                        <strong>📧 Email alerts + external contact</strong>
                        <p style="margin: 5px 0 0 0; font-size: 14px; color: #6b7280;">Get email alerts and customers are told you'll contact them via their preferred method (email/phone).</p>
                    </div>
                </label>
                
                <!-- Option 3: Dashboard -->
                <label class="alert-option" onclick="updateAlertOption(this)">
                    <input type="radio" name="alertPreference" value="dashboard">
                    <div>
                        <strong>💬 Two-way chat dashboard</strong>
                        <p style="margin: 5px 0 0 0; font-size: 14px; color: #6b7280;">Respond directly in the chat through a dashboard. Customers get real-time responses.</p>
                        <p style="margin: 5px 0 0 0; font-size: 12px; color: #8B5CF6; font-weight: 600;">📊 Dashboard link will be provided after setup!</p>
                    </div>
                </label>
            </div>
        </div>
        
        <!-- 🆕 EMAIL FIELD - Shows only when "email" is selected -->
        <div class="form-group" id="operatorEmailField" style="display: none;">
            <label for="operatorEmail">
                📧 Your Alert Email Address *
                <span class="info-icon">i
                    <div class="tooltip">Email address where you want to receive customer alerts and handoff notifications</div>
                </span>
            </label>
            <input type="email" id="operatorEmail" placeholder="alerts@yourbusiness.com">
            <p class="help-text">You'll receive notifications when customers request human support</p>
        </div>
        
        <!-- REST OF CONTACT PREFERENCES -->
        <div class="form-row">
            <div class="form-group">
                <label for="responseTime">
                    Expected Response Time
                    <span class="info-icon">i
                        <div class="tooltip">How quickly you typically respond to customer inquiries. This sets customer expectations.</div>
                    </span>
                </label>
                <select id="responseTime">
                    <option>15 minutes</option>
                    <option>30 minutes</option>
                    <option>1 hour</option>
                    <option>2 hours</option>
                    <option>Same day</option>
                </select>
            </div>
            <div class="form-group">
                <label for="contactMethods">
                    Preferred Contact Methods
                    <span class="info-icon">i
                        <div class="tooltip">How you prefer to contact customers when they request human assistance.<br><strong>Examples:</strong> "Email and phone", "WhatsApp preferred", "Text message only"</div>
                    </span>
                </label>
                <input type="text" id="contactMethods" placeholder="Email, Phone, WhatsApp">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="operatingHours">
                    Human Support Hours
                    <span class="info-icon">i
                        <div class="tooltip">When your team is available to respond to customer inquiries. The bot will mention these hours when appropriate.</div>
                    </span>
                </label>
                <input type="text" id="operatingHours" placeholder="9 AM - 5 PM EST, Monday-Friday">
            </div>
            <div class="form-group">
                <label for="handoffTriggers">
                    Agent Handoff Keywords
                    <span class="info-icon">i
                        <div class="tooltip">Additional words that should trigger connecting customers to a human agent.<br><strong>Default triggers:</strong> agent, human, speak to someone, representative, urgent<br><strong>Add your own:</strong> complaint, refund, cancel, booking issue</div>
                    </span>
                </label>
                <input type="text" id="handoffTriggers" placeholder="urgent, emergency, complaint, refund">
            </div>
        </div>
    </div>
</div>
           
            <!-- SMS Integration -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>📱 SMS Integration</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Enable two-way SMS conversations with customers</div>
                    
                    <div class="form-group">
                        <label for="smsEnabled">
                            📱 SMS Mode
                            <span class="info-icon">i
                                <div class="tooltip"><strong>Disabled:</strong> No SMS functionality<br><strong>Hybrid:</strong> Customers can choose between web chat and SMS<br><strong>SMS Primary:</strong> Collect phone numbers first for mobile-first experience</div>
                            </span>
                        </label>
                        <select id="smsEnabled" onchange="toggleSMSFields()">
                            <option value="disabled">Disabled - No SMS</option>
                            <option value="hybrid">Hybrid - Web Chat + SMS Option</option>
                            <option value="sms-first">SMS Primary - Collect phone numbers first</option>
                        </select>
                    </div>

                    <div id="smsFields" style="display: none;">
                        <div class="form-group">
                            <label for="businessSmsNumber">📞 Your Business SMS Number</label>
                            <input type="tel" id="businessSmsNumber" placeholder="+1 (555) 123-4567">
                            <p class="help-text">Your Twilio phone number that customers will text</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="smsHandoffMessage">💬 SMS Invitation Message (Hybrid Mode)</label>
                            <textarea id="smsHandoffMessage" rows="2" placeholder="💬 Prefer to text? You can also reach us at {PHONE_NUMBER} for mobile chat!"></textarea>
                            <p class="help-text">Message shown during agent handoff. Use {PHONE_NUMBER} as placeholder.</p>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="smsFirstMessage">📱 Welcome SMS (SMS-First Mode)</label>
                            <textarea id="smsFirstMessage" rows="2" placeholder="Hi! This is {BUSINESS_NAME}. Thanks for reaching out! How can we help you today?"></textarea>
                            <p class="help-text">First message sent via SMS when customer provides phone number. Use {BUSINESS_NAME} as placeholder.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Branding -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>🎨 Branding</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Customize the look and feel of your chat widget</div>
                    
                    <div class="form-group">
                        <label>Chat Widget Color Theme</label>
                        <div class="color-options">
                            <label class="color-option selected">
                                <input type="radio" name="brandColor" value="#8B5CF6" checked onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #8B5CF6;"></div>
                                <span>Purple</span>
                            </label>
                            <label class="color-option">
                                <input type="radio" name="brandColor" value="#3B82F6" onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #3B82F6;"></div>
                                <span>Blue</span>
                            </label>
                            <label class="color-option">
                                <input type="radio" name="brandColor" value="#10B981" onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #10B981;"></div>
                                <span>Green</span>
                            </label>
                            <label class="color-option">
                                <input type="radio" name="brandColor" value="#F59E0B" onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #F59E0B;"></div>
                                <span>Orange</span>
                            </label>
                            <label class="color-option">
                                <input type="radio" name="brandColor" value="#EF4444" onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #EF4444;"></div>
                                <span>Red</span>
                            </label>
                            <label class="color-option">
                                <input type="radio" name="brandColor" value="#6366F1" onchange="updateColorOption(this)">
                                <div class="color-swatch" style="background: #6366F1;"></div>
                                <span>Indigo</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waiver Integration -->
            <div class="form-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h3>📝 Waiver Integration</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                    <div class="section-description">Connect your Wherewolf waiver system</div>
                    
                    <div class="form-group">
                        <label for="waiverLink">Your Wherewolf Waiver Link</label>
                        <input type="url" id="waiverLink" placeholder="https://mono.wherewolf.co.nz/your-waiver-id">
                        <p class="help-text">Customers will be able to ask for the waiver and get this link automatically</p>
                    </div>
                </div>
            </div>

            <button type="submit" class="generate-btn">🚀 Generate My Enhanced Chatbot</button>
        </form>

        <div id="embedSection" style="display: none;">
            <!-- Success content will be dynamically generated here -->
        </div>
    </div>

    <script>
        // Generate time slots every 30 minutes
        function generateTimeSlots() {
            const timeSlotsContainer = document.getElementById('timeSlots');
            const times = [];
            
            for (let hour = 0; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const time = new Date(2000, 0, 1, hour, minute);
                    const timeStr = time.toLocaleTimeString('en-US', { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    });
                    times.push(timeStr);
                }
            }
            
            // Pre-select some popular times
            const popularTimes = ['9:00 AM', '2:00 PM', '5:00 PM'];
            
            times.forEach(time => {
                const isPopular = popularTimes.includes(time);
                const label = document.createElement('label');
                label.className = 'time-slot' + (isPopular ? ' selected' : '');
                label.innerHTML = `
                    <input type="checkbox" value="${time}" onchange="updateTimeSlot(this)" ${isPopular ? 'checked' : ''}>
                    <span>${time}</span>
                `;
                timeSlotsContainer.appendChild(label);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateTimeSlots();
            updateProgress();
        });

        // Section toggle functionality
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const isOpen = content.classList.contains('open');
            
            if (isOpen) {
                content.classList.remove('open');
                header.classList.remove('open');
            } else {
                content.classList.add('open');
                header.classList.add('open');
            }
            
            updateProgress();
        }

        // Update time slot selection
        function updateTimeSlot(checkbox) {
            const slotElement = checkbox.closest('.time-slot');
            slotElement.classList.toggle('selected', checkbox.checked);
        }

        // Update activity selection
        function updateActivityOption(checkbox) {
            const optionElement = checkbox.closest('.activity-option');
            optionElement.classList.toggle('selected', checkbox.checked);
        }

        // Update color selection
        function updateColorOption(radio) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            radio.closest('.color-option').classList.add('selected');
        }

        // 🔧 FIXED: Enhanced updateAlertOption function with better validation
function updateAlertOption(label) {
    // Remove selected class from all options
    document.querySelectorAll('.alert-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    label.classList.add('selected');
    
    // Check the radio button
    const radio = label.querySelector('input[type="radio"]');
    radio.checked = true;
    
    // 🆕 Show/hide email field based on selection
    const emailField = document.getElementById('operatorEmailField');
    const emailInput = document.getElementById('operatorEmail');
    
    console.log('🔧 Alert option selected:', radio.value);
    
    if (radio.value === 'email') {
        console.log('📧 Showing email field and setting required');
        emailField.style.display = 'block';
        emailInput.setAttribute('required', 'required');
        // Focus on email field after a short delay
        setTimeout(() => {
            emailInput.focus();
        }, 100);
    } else {
        console.log('❌ Hiding email field and removing required');
        emailField.style.display = 'none';
        emailInput.removeAttribute('required');
        emailInput.value = '';
    }
}

        // Toggle SMS fields
        function toggleSMSFields() {
            const smsEnabled = document.getElementById('smsEnabled').value;
            const smsFields = document.getElementById('smsFields');
            
            if (smsEnabled !== 'disabled') {
                smsFields.style.display = 'block';
                if (smsEnabled === 'hybrid' && !document.getElementById('smsHandoffMessage').value) {
                    document.getElementById('smsHandoffMessage').value = 
                        "💬 Prefer to text? You can also reach us at {PHONE_NUMBER} for mobile chat!";
                } else if (smsEnabled === 'sms-first' && !document.getElementById('smsFirstMessage').value) {
                    document.getElementById('smsFirstMessage').value = 
                        "Hi! This is {BUSINESS_NAME}. Thanks for reaching out! How can we help you today?";
                }
            } else {
                smsFields.style.display = 'none';
            }
        }

        // Toggle conditional sections based on booking link
        function toggleConditionalSections() {
            const bookingLink = document.getElementById('bookingLink').value;
            const pricingSection = document.getElementById('pricingSection');
            const scheduleSection = document.getElementById('scheduleSection');
            
            if (bookingLink) {
                // Add overlay to pricing section
                if (!pricingSection.querySelector('.conditional-overlay')) {
                    const pricingOverlay = document.createElement('div');
                    pricingOverlay.className = 'conditional-overlay';
                    pricingOverlay.textContent = 'Pricing questions will be deferred to your booking system';
                    pricingSection.appendChild(pricingOverlay);
                }
                
                // Add overlay to schedule section
                if (!scheduleSection.querySelector('.conditional-overlay')) {
                    const scheduleOverlay = document.createElement('div');
                    scheduleOverlay.className = 'conditional-overlay';
                    scheduleOverlay.textContent = 'Schedule questions will be deferred to your booking system';
                    scheduleSection.appendChild(scheduleOverlay);
                }
            } else {
                // Remove overlays
                const pricingOverlay = pricingSection.querySelector('.conditional-overlay');
                if (pricingOverlay) {
                    pricingOverlay.remove();
                }
                
                const scheduleOverlay = scheduleSection.querySelector('.conditional-overlay');
                if (scheduleOverlay) {
                    scheduleOverlay.remove();
                }
            }
        }

        // Update progress bar
        function updateProgress() {
            const totalSections = document.querySelectorAll('.form-section').length;
            const openSections = document.querySelectorAll('.section-content.open').length;
            const progress = (openSections / totalSections) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

// 🔧 COMPLETELY FIXED: Enhanced form submission with comprehensive hidden field detection
document.getElementById('chatbotForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // 🎯 SMART VALIDATION: Handle required fields properly
    console.log('🔧 Starting smart form validation...');
    
    // First, remove required from truly conditional fields
    const emailField = document.getElementById('operatorEmail');
    const alertPreference = document.querySelector('input[name="alertPreference"]:checked')?.value;
    
    if (emailField && alertPreference !== 'email') {
        emailField.removeAttribute('required');
        console.log('📧 Email not required for', alertPreference, 'mode');
    }
    
    // Remove required from SMS fields when SMS is disabled
    const smsFields = document.querySelectorAll('#smsFields input, #smsFields textarea, #smsFields select');
    const smsEnabled = document.getElementById('smsEnabled')?.value;
    if (smsEnabled === 'disabled') {
        smsFields.forEach(field => {
            if (field.hasAttribute('required')) {
                field.removeAttribute('required');
                console.log('📱 Removed required from SMS field:', field.id);
            }
        });
    }
    
    // Now check for any remaining required fields that are hidden
    const allRequiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
    console.log('🔍 Checking', allRequiredFields.length, 'required fields for visibility');
    
    for (const field of allRequiredFields) {
        const section = field.closest('.form-section');
        const sectionContent = field.closest('.section-content');
        const sectionHeader = section?.querySelector('.section-header');
        
        // Check if field is in a collapsed section
        if (sectionContent && !sectionContent.classList.contains('open')) {
            console.log('📂 Opening collapsed section for required field:', field.id);
            
            // Open the section
            sectionContent.classList.add('open');
            if (sectionHeader) {
                sectionHeader.classList.add('open');
            }
            
            // Update progress bar
            updateProgress();
            
            // Focus on the field and show validation message
            setTimeout(() => {
                field.focus();
                field.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
            
            // Show user-friendly message
            const fieldLabel = field.closest('.form-group')?.querySelector('label')?.textContent?.replace('*', '').trim() || field.id;
            alert(`Please fill in the required field: "${fieldLabel}"`);
            return; // Stop form submission
        }
        
        // Check if field is otherwise hidden
        if (field.offsetParent === null || field.style.display === 'none') {
            console.log('❌ Required field is hidden and cannot be shown:', field.id);
            const fieldLabel = field.closest('.form-group')?.querySelector('label')?.textContent?.replace('*', '').trim() || field.id;
            alert(`Required field "${fieldLabel}" is not accessible. Please check your form settings.`);
            return; // Stop form submission
        }
    }
    
    console.log('✅ All required fields are visible and accessible');

    try {
        // 🆕 FIXED: Check alert preference and email validation FIRST
        const alertPreferenceElement = document.querySelector('input[name="alertPreference"]:checked');
        if (!alertPreferenceElement) {
            alert('Please select an alert preference');
            return;
        }
        
        const selectedAlertPreference = alertPreferenceElement.value;
        
        // 🔧 CRITICAL FIX: Validate email field if email alert is selected
        if (selectedAlertPreference === 'email') {
            const emailInput = document.getElementById('operatorEmail');
            const emailField = document.getElementById('operatorEmailField');
            
            // Ensure email field is visible and has value
            if (!emailInput || emailField.style.display === 'none') {
                console.error('❌ Email field not visible but email alert selected');
                emailField.style.display = 'block';
                emailInput.setAttribute('required', 'required');
                emailInput.focus();
                alert('Please provide your email address for notifications');
                return;
            }
            
            const emailValue = emailInput.value.trim();
            if (!emailValue) {
                emailInput.focus();
                alert('Please provide your email address for notifications');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailValue)) {
                emailInput.focus();
                alert('Please provide a valid email address');
                return;
            }
            
            console.log('✅ Email validation passed:', emailValue);
        }

        // Collect all form data with error checking
        const selectedTimes = Array.from(document.querySelectorAll('.time-slot input:checked')).map(cb => cb.value);
        const selectedActivities = Array.from(document.querySelectorAll('.activity-option input:checked')).map(cb => cb.value);
        
        const brandColorElement = document.querySelector('input[name="brandColor"]:checked');
        
        if (!brandColorElement) {
            alert('Please select a brand color');
            return;
        }
        
        const selectedColor = brandColorElement.value;

        // 🔧 FIXED: Get email value safely - only if email alert is selected
        let operatorEmail = '';
        if (selectedAlertPreference === 'email') {
            operatorEmail = document.getElementById('operatorEmail').value.trim();
        }

        const config = {
            // Basic Information
            businessName: document.getElementById('businessName').value,
            operatorEmail: operatorEmail, // 🔧 FIXED: Conditional email
            businessType: document.getElementById('businessType').value,
            location: document.getElementById('location').value,
            smsEnabled: document.getElementById('smsEnabled').value,
            businessSmsNumber: document.getElementById('businessSmsNumber').value,
            smsHandoffMessage: document.getElementById('smsHandoffMessage').value,
            smsFirstMessage: document.getElementById('smsFirstMessage').value,
            weatherLocation: document.getElementById('weatherLocation').value,
            weatherEnabled: document.getElementById('weatherEnabled').value === 'true',
            weatherStyle: document.getElementById('weatherStyle').value,
            
            // Business Details
            websiteUrl: document.getElementById('websiteUrl').value,
            phoneNumber: document.getElementById('phoneNumber').value,
            businessHours: document.getElementById('businessHours').value,
            peakSeason: document.getElementById('peakSeason').value,
            maxGroupSize: document.getElementById('maxGroupSize').value,
            companyTagline: document.getElementById('companyTagline').value,
            
            // Activity Customization
            activityTypes: selectedActivities,
            difficultyLevel: document.getElementById('difficultyLevel').value,
            minAge: document.getElementById('minAge').value,
            maxAge: document.getElementById('maxAge').value,
            durationOptions: document.getElementById('durationOptions').value,
            seasonalAvailability: document.getElementById('seasonalAvailability').value,
            
            // Schedule & Pricing
            times: selectedTimes,
            duration: document.getElementById('duration').value,
            adultPrice: document.getElementById('adultPrice').value,
            childPrice: document.getElementById('childPrice').value,
            groupDiscount: document.getElementById('groupDiscount').value,
            specialOffers: document.getElementById('specialOffers').value,
            
            // Policies
            whatToBring: document.getElementById('whatToBring').value,
            cancellationPolicy: document.getElementById('cancellationPolicy').value,
            weatherPolicy: document.getElementById('weatherPolicy').value,
            
            // Chatbot Personality
            chatbotTone: document.getElementById('chatbotTone').value,
            languageStyle: document.getElementById('languageStyle').value,
            expertiseLevel: document.getElementById('expertiseLevel').value,
            responseLength: document.getElementById('responseLength').value,
            customGreeting: document.getElementById('customGreeting').value,
            
            // Knowledge Boundaries - NOTE: weatherInfo removed as requested
            realTimeInfo: document.getElementById('realTimeInfo').value,
            dontAnswerTopics: document.getElementById('dontAnswerTopics').value,
            additionalKnowledge: document.getElementById('additionalKnowledge').value,
            
            // Advanced Features
            bookingLink: document.getElementById('bookingLink').value,
            socialMedia: document.getElementById('socialMedia').value,
            certifications: document.getElementById('certifications').value,
            
            // Contact Preferences
            alertPreference: selectedAlertPreference, // 🔧 This is already validated above
            responseTime: document.getElementById('responseTime').value,
            contactMethods: document.getElementById('contactMethods').value,
            operatingHours: document.getElementById('operatingHours').value,
            handoffTriggers: document.getElementById('handoffTriggers').value,
            
            // Branding
            brandColor: selectedColor,
            
            // Waiver
            waiverLink: document.getElementById('waiverLink').value
        };

        console.log('Submitting enhanced config:', config);

        const response = await fetch('/api/save-config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(config)
        });

        const result = await response.json();
        console.log('Server response:', result);

        if (result.success && result.embedCode) {
            // Create enhanced success section with conditional dashboard link
            const successSection = document.getElementById('embedSection');
            let successHTML = `
                <h3 style="margin-top: 40px;">🎉 Your Enhanced Chatbot is Ready!</h3>
                <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981; border-radius: 12px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #047857; margin: 0 0 10px 0;">✅ Operator ID: <code style="background: white; padding: 4px 8px; border-radius: 4px; font-weight: bold;">${result.operatorId}</code></h4>
            `;
            
            if (selectedAlertPreference === 'dashboard') {
                successHTML += `
                    <div style="background: #8B5CF6; color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0;">📊 Your Dashboard Link:</h4>
                        <a href="${result.baseUrl}/dashboard" target="_blank" style="color: white; font-weight: bold; text-decoration: underline; font-size: 16px;">${result.baseUrl}/dashboard</a>
                        <p style="margin: 10px 0 0 0; font-size: 14px; opacity: 0.9;">💡 Bookmark this link! Use it to respond to customers in real-time.</p>
                    </div>
                `;
            } else if (selectedAlertPreference === 'email') {
                successHTML += `
                    <div style="background: #f59e0b; color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0;">📧 Email Alerts Enabled</h4>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">You'll receive email notifications at <strong>${operatorEmail}</strong> when customers request human support.</p>
                    </div>
                `;
            } else {
                successHTML += `
                    <div style="background: #6b7280; color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0;">🤖 AI-Only Mode</h4>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">Your chatbot will handle all requests automatically without human alerts.</p>
                    </div>
                `;
            }
            
            successHTML += `
                </div>
                <p style="margin-bottom: 20px;">Copy this code and paste it into your website:</p>
            `;
            
            successSection.innerHTML = successHTML + `
                <div class="embed-code">
                    <button class="copy-btn" onclick="copyCode()">Copy Code</button>
                    <pre id="embedCode">${result.embedCode.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                </div>
                
                <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin: 20px 0;">
                    <h4 style="margin: 0 0 15px 0; color: #374151;">🚀 Next Steps:</h4>
                    <ol style="margin: 0; padding-left: 20px; color: #6b7280;">
                        <li style="margin-bottom: 8px;">Copy the embed code above and paste it into your website</li>
                        <li style="margin-bottom: 8px;">Test your chatbot by visiting your website</li>
                        ${selectedAlertPreference === 'dashboard' ? '<li style="margin-bottom: 8px;"><strong>Bookmark your dashboard link</strong> for responding to customers</li>' : ''}
                        <li style="margin-bottom: 8px;">Try asking for an agent to test the handoff system</li>
                        <li>Customize further by creating a new chatbot with different settings</li>
                    </ol>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <a href="/setup" style="background: #8B5CF6; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600;">Create Another Chatbot</a>
                    ${selectedAlertPreference === 'dashboard' ? `<a href="${result.baseUrl}/dashboard" target="_blank" style="background: #10b981; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; margin-left: 10px;">Open Dashboard</a>` : ''}
                </div>
            `;
            
            successSection.style.display = 'block';
            successSection.scrollIntoView({ behavior: 'smooth' });
        } else {
            alert('Failed to generate chatbot: ' + JSON.stringify(result));
        }
    } catch (error) {
        console.error('Form submission error:', error);
        alert('Error saving configuration: ' + error.message);
    }
});

        function copyCode() {
            const embedCodeElement = document.getElementById('embedCode');
            const textToCopy = embedCodeElement.textContent;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Embed code copied to clipboard!');
                });
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Embed code copied to clipboard!');
            }
        }
    </script>
<script>
// 🔧 FIXED: Enhanced DOMContentLoaded with better initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔧 Page loaded, checking pre-selected options...');
    
    const emailRadio = document.querySelector('input[name="alertPreference"][value="email"]');
    const emailField = document.getElementById('operatorEmailField');
    const emailInput = document.getElementById('operatorEmail');
    
    console.log('📻 Email radio found:', emailRadio ? 'YES' : 'NO');
    console.log('📻 Email radio checked:', emailRadio ? emailRadio.checked : 'N/A');
    console.log('📧 Email field found:', emailField ? 'YES' : 'NO');
    
    if (emailRadio && emailRadio.checked && emailField && emailInput) {
        console.log('✅ Email option pre-selected, showing email field');
        emailField.style.display = 'block';
        emailInput.setAttribute('required', 'required');
    } else {
        console.log('❌ Email option not pre-selected or elements not found');
        // 🔧 ENSURE email field is hidden and not required by default
        if (emailField && emailInput) {
            emailField.style.display = 'none';
            emailInput.removeAttribute('required');
            emailInput.value = '';
        }
    }
    
    // 🔧 ADDITIONAL: Initialize other functions
    generateTimeSlots();
    updateProgress();
});
</script>
</body>
</html>